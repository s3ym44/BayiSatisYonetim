@model SalesReportViewModel
@{
    ViewData["Title"] = "Satış Raporları";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<h4 class="mb-4"><i class="bi bi-graph-up"></i> Satış Raporları</h4>

<div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
        <form method="get" class="row g-2 align-items-end">
            <div class="col-md-3">
                <label class="form-label small">Başlangıç Tarihi</label>
                <input type="date" name="startDate" class="form-control form-control-sm" value="@Model.StartDate?.ToString("yyyy-MM-dd")" />
            </div>
            <div class="col-md-3">
                <label class="form-label small">Bitiş Tarihi</label>
                <input type="date" name="endDate" class="form-control form-control-sm" value="@Model.EndDate?.ToString("yyyy-MM-dd")" />
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-sm btn-outline-primary w-100"><i class="bi bi-search"></i> Filtrele</button>
            </div>
        </form>
    </div>
</div>

<div class="row g-3 mb-4">
    <div class="col-md-4">
        <div class="card border-0 shadow-sm text-center p-3">
            <h3 class="text-primary mb-0">@Model.TotalSales</h3>
            <small class="text-muted">Toplam Satış</small>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-0 shadow-sm text-center p-3">
            <h3 class="text-success mb-0">@Model.TotalRevenue.ToString("N0") ₺</h3>
            <small class="text-muted">Toplam Gelir</small>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-0 shadow-sm text-center p-3">
            <h3 class="text-warning mb-0">@Model.TotalCommissions.ToString("N0") ₺</h3>
            <small class="text-muted">Toplam Komisyon</small>
        </div>
    </div>
</div>

<div class="row g-3 mb-4">
    <div class="col-md-8">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white"><h6 class="mb-0">Aylık Satışlar</h6></div>
            <div class="card-body"><canvas id="monthlySalesChart" height="200"></canvas></div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white"><h6 class="mb-0">Kategori Dağılımı</h6></div>
            <div class="card-body"><canvas id="categorySalesChart" height="200"></canvas></div>
        </div>
    </div>
</div>

<div class="card border-0 shadow-sm">
    <div class="card-header bg-white"><h6 class="mb-0">Satış Detayları</h6></div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover table-sm mb-0">
                <thead class="table-light">
                    <tr><th>Başvuru No</th><th>Bayi</th><th>Müşteri</th><th>Ürün</th><th>Kategori</th><th>Tutar</th><th>Komisyon</th><th>Durum</th><th>Tarih</th></tr>
                </thead>
                <tbody>
                    @foreach (var s in Model.Sales)
                    {
                        <tr>
                            <td>@s.ApplicationNumber</td><td>@s.DealerName</td><td>@s.CustomerName</td>
                            <td>@s.ProductName</td><td><span class="badge bg-info">@s.CategoryName</span></td>
                            <td><strong>@s.Amount.ToString("N0") ₺</strong></td><td>@s.CommissionAmount.ToString("N0") ₺</td>
                            <td>
                                @if (s.CommissionStatus == "Paid") { <span class="badge bg-success">Ödendi</span> }
                                else { <span class="badge bg-warning">Beklemede</span> }
                            </td>
                            <td>@s.SaleDate.ToString("dd.MM.yyyy")</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
<script>
new Chart(document.getElementById('monthlySalesChart').getContext('2d'), {
    type: 'bar',
    data: {
        labels: [@Html.Raw(string.Join(",", Model.MonthlySales.Select(m => $"'{m.Month}'")))],
        datasets: [{ label: 'Satış (₺)', data: [@string.Join(",", Model.MonthlySales.Select(m => m.Amount))], backgroundColor: 'rgba(37,99,235,0.7)', borderRadius: 6 }]
    },
    options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
});
new Chart(document.getElementById('categorySalesChart').getContext('2d'), {
    type: 'doughnut',
    data: {
        labels: [@Html.Raw(string.Join(",", Model.CategorySales.Select(c => $"'{c.CategoryName}'")))],
        datasets: [{ data: [@string.Join(",", Model.CategorySales.Select(c => c.Count))], backgroundColor: ['#2563eb','#10b981','#f59e0b','#ef4444','#8b5cf6'] }]
    },
    options: { responsive: true }
});
</script>
}
